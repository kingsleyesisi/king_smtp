# OpenDKIM Configuration File
# This file configures OpenDKIM for signing outgoing emails with DKIM signatures
#
# DKIM (DomainKeys Identified Mail) helps verify that emails are actually
# from your domain and haven't been tampered with in transit

# ============================================================================
# BASIC SETTINGS
# ============================================================================

# Log to syslog
Syslog yes

# Log level (default is info)
# Options: none, 1-8 (higher = more verbose)
SyslogSuccess yes
LogWhy yes

# User and group to run as
UserID opendkim:opendkim

# ============================================================================
# SOCKET SETTINGS
# ============================================================================

# Socket for communication with Postfix
# This must match the smtpd_milters setting in Postfix main.cf
# Format: inet:PORT@INTERFACE
Socket inet:8891@localhost

# Alternative: use a Unix socket instead (more secure but requires permissions)
# Socket local:/var/spool/postfix/opendkim/opendkim.sock

# ============================================================================
# PID FILE
# ============================================================================

# Location of PID file
PidFile /run/opendkim/opendkim.pid

# ============================================================================
# MODES OF OPERATION
# ============================================================================

# Sign outgoing emails (s)
# Verify incoming emails (v)
# We only sign outgoing emails for this simple setup
Mode sv

# ============================================================================
# CANONICALIZATION
# ============================================================================

# How to prepare the email for signing
# Format: header/body
# Options: simple, relaxed
#
# simple:  Preserves whitespace exactly
# relaxed: Allows minor modifications (recommended for compatibility)
Canonicalization relaxed/simple

# ============================================================================
# DOMAIN AND SELECTOR
# ============================================================================

# Domain to sign for
# Replace with your actual domain
Domain yourdomain.com

# DKIM selector
# This is an arbitrary name used to identify your DKIM key
# Common selectors: default, mail, dkim
# The selector is used in DNS: SELECTOR._domainkey.yourdomain.com
Selector default

# ============================================================================
# KEY CONFIGURATION
# ============================================================================

# Path to private key for signing
# This key is generated during setup and must be kept secure
KeyFile /etc/opendkim/keys/yourdomain.com/default.private

# Alternative: use a key table for multiple domains
# KeyTable /etc/opendkim/KeyTable
# SigningTable refile:/etc/opendkim/SigningTable

# ============================================================================
# TRUSTED HOSTS
# ============================================================================

# Hosts/networks that are allowed to send mail through this server
# These emails will be signed with DKIM
ExternalIgnoreList refile:/etc/opendkim/TrustedHosts
InternalHosts refile:/etc/opendkim/TrustedHosts

# ============================================================================
# SECURITY SETTINGS
# ============================================================================

# Automatically restart on failure
AutoRestart yes

# Number of restarts before giving up
AutoRestartRate 10/1h

# Background mode
Background yes

# Use DNS to verify DKIM signatures (for incoming mail)
DNSTimeout 5

# ============================================================================
# SIGNATURE SETTINGS
# ============================================================================

# Include the body length in the signature
# This prevents tampering with long emails
SignatureAlgorithm rsa-sha256

# Minimum key bits (2048 is recommended)
MinimumKeyBits 1024

# ============================================================================
# STATISTICS AND REPORTING
# ============================================================================

# Enable statistics (optional)
#Statistics /var/spool/opendkim/stats.dat

# Report info to syslog
SyslogSuccess yes

# ============================================================================
# NOTES AND DOCUMENTATION
# ============================================================================

# IMPORTANT: After editing this file, run:
#   sudo systemctl restart opendkim
#
# To check if OpenDKIM is running:
#   sudo systemctl status opendkim
#
# To test DKIM signing:
#   sudo opendkim-testkey -d yourdomain.com -s default -vvv
#
# DNS RECORD:
#   You must publish your public key in DNS as a TXT record:
#   Record: default._domainkey.yourdomain.com
#   Type: TXT
#   Value: v=DKIM1; k=rsa; p=YOUR_PUBLIC_KEY_HERE
#
# The public key is in: /etc/opendkim/keys/yourdomain.com/default.txt
